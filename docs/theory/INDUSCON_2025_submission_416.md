\documentclass[a4paper, 10pt, conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\addtolength{\topmargin}{0cm}
\addtolength{\textheight}{0.7in}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Digital Twin-Driven FMC-TFM Simulation for Ultrasonic Phased Arrays Across Fluid-Solid Interfaces: Delay Law and FWHM Analysis}

\author{
\IEEEauthorblockN{Alexandre Rabelo}
\IEEEauthorblockA{
\textit{Dept. of Mechatronics Engineering} \\
\textit{University of São Paulo, USP} \\
São Paulo, Brazil \\
arabelo@usp.br}
\and
\IEEEauthorblockN{Timoteo F. de Oliveira}
\IEEEauthorblockA{
\textit{Dept. of Mechatronics Engineering} \\
\textit{University of São Paulo, USP} \\
São Paulo, Brazil \\
tim@usp.br}
\and
\IEEEauthorblockN{Flávio Buiochi}
\IEEEauthorblockA{
\textit{Dept. of Mechatronics Engineering} \\
\textit{University of São Paulo, USP} \\
São Paulo, Brazil \\
fbuiochi@usp.br}
}

\maketitle

\begin{abstract}

This paper presents a digital-twin-based simulation framework for modeling ultrasound phased array inspections through fluid–solid interfaces, with a focus on the beamforming principles of FMC and TFM. The system simulates a phased array immersed in a coupling fluid and evaluates beam propagation and focusing behavior across planar boundaries using high-frequency ray theory. The pipeline integrates field simulation and Snell's law-based delay law computation, fully implemented in Python and grounded in canonical models from the literature. Quantitative evaluation is performed using FWHM metrics and delay law resolution analysis. The results confirm the ability of the framework to replicate key focus characteristics and quantify resolution degradation due to delay quantization. Multiple FWHM estimation methods are benchmarked, reinforcing the framework's utility to validate and tune FMC-TFM-based strategies in multilayer media environments.

\end{abstract}

\begin{IEEEkeywords}
Ultrasonic simulation, digital twin, phased array, FMC, TFM, fluid–solid interface, FWHM estimation.
\end{IEEEkeywords}

\section{Introduction}

Nondestructive testing (NDT) plays a vital role in the evaluation of structural integrity in industries such as aerospace, power generation, oil and gas. Among various techniques, phased array ultrasonic systems are widely adopted for their beam steering, focusing, and real-time imaging capabilities \cite{b3}, \cite{b6}. However, inspection of components immersed in coupling fluids, such as water, and bonded to solid materials poses a significant challenge due to beam distortion at the fluid–solid interface. Effects such as refraction, transmission losses, and mode conversion often degrade resolution and reduce the detectability of defects at depth \cite{b3}, \cite{b6}.

To address these limitations, full matrix capture (FMC) combined with the total focusing method (TFM) has emerged as a powerful framework for synthetic focus at every point in the region of interest \cite{b6}. In this approach, all pairs of transmit-receive elements are activated to record time-domain signals, enabling offline reconstruction of high-resolution images with improved lateral resolution. The method is particularly suitable for detecting small defects and evaluating components with complex geometries \cite{b2}, \cite{b6}.

Despite advances in FMC-TFM-based imaging, modeling and quantifying the behavior of acoustic beams across interfaces remains a challenge. Many simulation platforms simplify wave propagation, often assuming homogeneous media, and neglect important details like refraction, anisotropy, or focal-law accuracy in interface-transmitted beams. Furthermore, the high cost and limited flexibility of the experimental setups constrain the repeatability and systematic study of parameter variation. Recent advances in simulation technology, particularly those informed by the concept of digital twins, offer new opportunities for realistic, tunable, and high-fidelity imaging system design \cite{b5}.

In this work, we propose a simulation pipeline based on the digital twin paradigm to study FMC–TFM–based ultrasonic beamforming through fluid–solid interfaces. The pipeline is derived from the canonical models presented by Schmerr~\cite{b1}, encompassing array steering, time-delay synthesis, and field modeling using both analytical and numerical tools. The framework simulates the pressure field generated by the array and models the focusing behavior underpinning the TFM principles. Quantitative evaluation is performed through full-width at half maximum (FWHM) analysis of beam envelopes, supported by theoretical predictions.

The remainder of this paper is organized as follows. Section II introduces the theoretical background of beam modeling and delay law formulation. Section III presents the digital twin simulation framework and its modular components. Section IV describes the FMC-TFM imaging workflow, including signal generation, delay application, and beam quantification methods. Section V discusses the simulation results, including delay law resolution, TFM reconstruction, and accuracy of FWHM estimation. Section VI concludes the paper and provides directions for future work.

\section{Theoretical Background}

The modeling of ultrasound beams across planar fluid-solid interfaces requires an accurate description of pressure and velocity fields that incorporate reflection, refraction, transmission, and geometric spreading effects. These phenomena arise from solving the scalar wave equation for layered media using high-frequency approximations. In this context, we adopt analytical models based on rays derived from Schmerr's theoretical formulation \cite{b1}.

\subsection{Piston Source Model}

The pressure field radiated by a finite-size transducer element into a homogeneous fluid medium can be modeled using a line-source approximation, discretized into equally spaced segments. This model, described in Schmerr \cite{b1}, evaluates the total field as a superposition of contributions from each segment, represented by zeroth-order Hankel functions.

The normalized pressure field at a field point \((x, z)\) due to a uniform piston source of half width \(b\) is given by the following:

\begin{equation}
\frac{p(x, z, \omega)}{\rho_{1} c_{1} v_0(\omega)} = \frac{k_{1} b}{N} \sum_{n=1}^{N} H_0^{(1)}\left(k_{1} b \bar{r}_n\right),
\label{eq:rs2Dv}
\end{equation}
where \(H_0^{(1)}\) is the zeroth-order Hankel function of the first kind,  
\(k_{1} = \omega / c_{1}\) is the wavenumber in the fluid,  
\(\rho_{1}\) and \(c_{1}\) are the fluid density and wave speed,  
\(v_0(\omega)\) is the input velocity spectrum,  
\(N\) is the number of ray segments,  
\(\bar{r}_n = \sqrt{(x / b - \bar{x}_n)^2 + (z / b)^2}\) is the normalized distance from segment \(n\) to the field point,  
and \(\bar{x}_n = -1 + \frac{2}{N} \left(n - \frac{1}{2} \right)\) defines the normalized center location of the \(n\)-th segment.

This discrete formulation is implemented in the Python program and serves as the core engine for synthetic A-scan generation in fluid-only simulations.

\subsection{Line Source Model}

The linear source program numerically evaluates the pressure field at a field point \((x,z)\) generated by a 2D linear array source that radiates through a planar interface between two fluids \cite{b1}, as in:

\begin{align}
p(x, z) &= \rho_{1} c_{1} v_{0}(\omega) \sqrt{\frac{2k_{1} b}{\pi i}} \notag \\ &\quad \times \frac{1}{N} \sum_{n=1}^{N}\frac{T_{p0}(\theta_{10}^{n}) \exp\left(i k_{1} b\bar{r}_{10}^{n} + i k_{2} b\bar{r}_{20}^{n}\right)}{\sqrt{\bar{r}_{10}^{n} + \frac{c_{2}}{c_{1}} \frac{\cos^2(\theta_{10}^{n})}{\cos^2(\theta_{20}^{n})} \bar{r}_{20}^{n}}} D_{\frac{b}{N}}(\theta),
\label{eq:ls2dint}
\end{align}
where \(\rho_1\) and \(c_1\) are the fluid density and sound speed in medium 1, \(v_0(\omega)\) is the input velocity spectrum, \(k_1 = \omega/c_1\) and \(k_2 = \omega/c_2\) are the wavenumbers in the fluid and solid, \(b\) is the half-aperture width of the array, \(N\) is the number of ray segments, \(T_{p0}(\theta_{10}^{n})\) is the pressure transmission coefficient at the \(n\)-th incidence angle, \(\bar{r}_{10}^{n}\) and \(\bar{r}_{20}^{n}\) are the normalized path lengths in fluid and solid media, \(\theta_{10}^{n}\) and \(\theta_{20}^{n}\) are the incidence and refraction angles, and \(D_{\frac{b}{N}}(\theta)\) is the directivity function of each sub-element. Basically, it captures the amplitude, phase, and directional effects induced by the interface and is also implemented in Python.


\subsection{Point Source Model}

In contact or immersion inspections involving fluid–solid interfaces, the velocity field radiated by each subelement of a rectangular ultrasonic array modeled as a 3D point source can be computed using high-frequency ray theory~\cite{b1}. The expressions account for wave type–specific velocities, with \(c_{p1}\) and \(c_{\beta2}\) denoting compression wave speed in the fluid and transmitted wave speed (compressional or shear) in the solid, respectively. For a rectangular segment divided into sub-elements \(R \times Q\), the velocity at an observation point \(\mathbf{x}\) and the angular frequency \(\omega\) are given by the following equation:

\begin{align}
\mathbf{v}(\mathbf{x}, \omega) &= \frac{-i k_{p1} p_0(\omega) \, \Delta d_x \Delta d_y}{2 \pi \rho_1 c_{p1}} \notag \\
&\quad \times 
\sum_{r=1}^{R} \sum_{q=1}^{Q} K_p(\bar{\theta}^{rq}) \, \bar{T}_{ss}^{\beta;p}(\bar{\theta}_1^{rq}) \, \bar{\mathbf{d}}_{\beta2}^{rq} \notag \\
&\quad \times \frac{\sin\left(k_{p1} u_{x'}^{rq} \Delta d_x / 2\right)}{k_{p1} u_{x'}^{rq} \Delta d_x / 2} 
\cdot \frac{\sin\left(k_{p1} u_{y'}^{rq} \Delta d_y / 2\right)}{k_{p1} u_{y'}^{rq} \Delta d_y / 2} \notag \\
&\quad \times \frac{
\exp\left[i k_{p1} r_1^{rq} + i k_{\beta2} r_2^{\beta;rq} \right]
}{
\sqrt{ \left( r_1^{rq} + \frac{c_{\beta2}}{c_{p1}} \frac{\cos^2(\bar{\theta}_1^{rq})}{\cos^2(\bar{\theta}_2^{rq})} r_2^{\beta;rq} \right)
\left( r_1^{rq} + \frac{c_{\beta2}}{c_{p1}} r_2^{\beta;rq} \right)
}
},
\label{eq:ps3Dint_contact}
\end{align}
where \(\mathbf{x}\) is the field point, \(\omega\) is the angular frequency, \(p_0(\omega)\) is the input pressure spectrum, \(\Delta d_x\) and \(\Delta d_y\) are the element dimensions, \(\rho_1\) and \(c_{p1}\) are the density and compressional wave speed in the fluid, \(k_{p1} = \omega / c_{p1}\) and \(k_{\beta2} = \omega / c_{\beta2}\) are the wavenumbers in the fluid and solid, \(K_p(\bar{\theta}^{rq})\) is the geometric scaling factor, \(\bar{T}_{ss}^{\beta;p}(\bar{\theta}_1^{rq})\) is the mode-converted transmission coefficient, \(\bar{\mathbf{d}}_{\beta2}^{rq}\) is the unit polarization vector, \(u_{x'}^{rq}\), \(u_{y'}^{rq}\) are direction cosines, \(r_1^{rq}\), \(r_2^{\beta;rq}\) are ray path lengths in fluid and solid media, and \(\bar{\theta}_1^{rq}\), \(\bar{\theta}_2^{rq}\) are the incidence and refraction angles evaluated along the ray from segment \((r,q)\) to point \(\mathbf{x}\).

\subsection{Delay Law Formulation}

To accurately steer and focus ultrasonic beams through a planar interface between two different media, such as water and steel, time delay laws must be formulated to correct for the refraction-induced path differences among transducer elements.

The general delay time \(\Delta t_{mn}^{d}\) for the \( (m,n) \)-th element in a 2-D array is computed differently depending on whether the goal is steering alone or both steering and focusing. These are formalized as follows, based on the derivations in Schmerr \cite{b1}:

For steering alone:

\begin{equation}
\Delta t_{mn}^{d} = \left| \left\{ \Delta t_{mn} \right\}_{\text{min}} \right| + \Delta t_{mn},
\label{eq:delay_law_steering}
\end{equation}

and for steering with focusing through a planar interface:

\begin{equation}
\Delta t_{mn}^{d} = \left( \Delta t_{mn} \right)_{\text{max}} - \Delta t_{mn},
\label{eq:delay_law_focusing}
\end{equation}
where \( \Delta t_{mn} \) is the time of flight from element \((m,n)\) to the focal point, \( \Delta t_{mn}^{d} \) is the final digital delay applied to element \((m,n)\), and \((\Delta t_{mn})_{\text{min}}, (\Delta t_{mn})_{\text{max}} \) are the minimum and maximum geometric delays across the array. The ray paths are computed considering fluid and solid wave velocities \( c_1 \) and \( c_2 \), a planar interface at depth \( DT_0 \), and focal depth \( DF \).

These expressions ensure that all delays are non-negative and aligned for digital implementation. The term \(\Delta t_{mn}\) represents the geometric delay associated with the travel time from the \( (m,n) \)-th element to the focal point \( \mathbf{x} \), accounting for the refraction at the interface and the different sound speeds in the two media.

A program implements both equations using geometric ray tracing based on Snell’s law. It supports arbitrary steering angles \(\theta_T\), \(\phi\), a refraction angle \(\theta_2\), array geometry, and interface geometry \cite{b1}.

\subsection{Quantitative Evaluation}

To quantitatively evaluate the performance of the simulation pipeline and the effectiveness of the synthetic focusing, we compute the FWHM of the beam envelope along defined cross sections of interest. It is widely recognized as a robust metric for characterizing resolution in imaging systems, as it measures the width of a response function at 50\% of its peak amplitude. In this study, we apply a definition-based method where the peak amplitude is located, and the width of the beam profile at 50\% of this maximum is estimated by interpolation.

\begin{equation}
\text{FWHM} = x_2 - x_1, \quad \text{where} \quad A(x_1) = A(x_2) = 0.5 \cdot A_{\text{max}},
\label{eq:fwhm}
\end{equation}
where \(x_1\) and \(x_2\) are the positions along the beam envelope where the amplitude \(A(x)\) drops to 50\% of its maximum value, i.e., \(A(x_1) = A(x_2) = 0.5 \cdot A_{\text{max}}\). These points correspond to the left and right crossings of the beam profile at half its peak, and the FWHM is defined as the distance between them \cite{b15}.

To increase precision, the crossing points at half the maximum amplitude are estimated using local quadratic interpolation around the envelope samples.

Several estimation methods for FWHM exist in the literature, including approaches based on Gaussian fitting, statistical moments, and standard deviation scaling. A recent comparative analysis of seven methods by Rainio et al. \cite{b7} shows that definition-based and NEMA-standard methods provide reliable results, especially when applied to sparse or noisy datasets. These findings reinforce our choice of using a direct definition-based interpolation technique, which ensures robustness and interpretability in the simulation results.

In addition to the main definition-based measurement, we evaluated multiple FWHM estimation strategies as proposed by Rainio et al. \cite{b7}, labeled F1 through F7. These include: F1 - definition-based estimation (peak to half max), F2 - area-based estimation from envelope energy, F3 - moment-based estimation using statistical variance, F4 - log-parabola fit to the envelope, F5 - slope-based width from a logarithmic fit, F6 - local quadratic interpolation around half-max crossings, and F7 - Gaussian model fitting via optimization. Each method was compared with a theoretical FWHM baseline derived from classical diffraction theory.

\begin{equation}
\text{FWHM}_{\text{theory}} = \frac{c_2 \cdot 1000}{f \cdot 10^6} \cdot \text{DF},
\label{eq:fwhm_theory}
\end{equation}
where \(c_2\) is the longitudinal velocity in the solid, \(f\) is the central frequency (MHz), and DF is the F-number. This multimethod approach provides robustness and confidence in our quantitative beam evaluation.

\section{Digital Twin Simulation Framework}

The proposed simulation framework adopts the digital twin paradigm to replicate the behavior of ultrasonic phased array inspections in fluid-solid layered media. As a virtual mirror of the real inspection system, the framework is capable of modeling pressure and velocity fields, synthesizing delay laws, and reconstructing focused ultrasonic images using FMC-TFM techniques. This virtualized inspection system facilitates parametric exploration and repeatability, while eliminating experimental complexity and cost.

The framework is implemented in Python and structured in modules, each replicating a distinct part of the acquisition and reconstruction process. It builds on the canonical mathematical models described by Schmerr \cite{b1}, with custom adaptations to handle interface-induced propagation effects.

The simulation pipeline includes the following components:

\begin{itemize}
    \item \textbf{Field Modeling:} The pressure and velocity fields are simulated using physically grounded beam propagation models derived from ray theory and Kirchhoff-type approximations~\cite{b1}. These models incorporate phenomena such as wave speed discontinuities, acoustic transmission coefficients, Snell’s law for refraction, and directivity effects across fluid-solid interfaces.
    
    \item \textbf{Delay Law Computation:} Time delays for beam steering and focus through planar interfaces are computed using custom numerical algorithms developed within this framework~\cite{b1}. These methods consider the geometric paths of rays across material boundaries and apply refraction principles to ensure accurate focusing.

    \item \textbf{Synthetic Signal Generation:} Using a virtual FMC scheme, the framework simulates transmit–receive responses for all pairs of elements, generating input data for the TFM stage. The concept of FMC as a complete transmission-receive acquisition strategy was introduced and widely formalized in \cite{b12}, providing the foundation for post-processed imaging such as TFM. The beam summation incorporates apodization and interpolated delay compensation.

    \item \textbf{Image Reconstruction:} A Python-based TFM routine processes FMC data to synthetically focus at all image points. This mirrors physical systems and enables precise analysis of focus performance and resolution. The TFM image reconstruction algorithm, based on delay-and-sum beamforming with time-of-flight compensation, was established by Holmes et al. \cite{b13} and has become a cornerstone of high-resolution ultrasonic imaging.

    \item \textbf{Post-Processing and Evaluation:} A dedicated module evaluates focus quality using FWHM, beam profiles, and alignment with theoretical predictions \cite{b7}.
\end{itemize}

The modular structure supports rapid parameter studies, sensitivity analysis, and system optimization. This approach is aligned with the digital twin strategies adopted in the recent literature on ultrasonic inspections \cite{b8,b9}. Specifically, the use of ray-based wave modeling \cite{b10} and the refinement of the delay and sum (DAS) method \cite{b11} substantiates our implementation as a viable digital twin for phased array inspection scenarios.

\section{FMC-TFM Imaging and Quantification Methodology}
% Describe how the FMC matrix is generated and processed
% Explain how TFM reconstruction is performed
% Present how FWHM, envelope detection, and delay law comparison are computed

This section outlines the core simulation workflow used to replicate ultrasonic phased array imaging using the FMC and TFM pipeline.

\subsection{FMC Data Simulation}
A complete synthetic FMC dataset is constructed by simulating the time-domain response for every transmit–receive pair in the array. Each transmitter is excited sequentially, while pressure or velocity responses are computed at all receiver positions using the field models described in Section II. For each focal law, the paths are corrected for interface effects (refraction, travel time, and beam spread). The data is stored in a three-dimensional array indexed by transmit element, receive element, and time sample.

\subsection{Delay-and-Sum TFM Reconstruction}
The image reconstruction step uses the TFM as introduced by Holmes et al. \cite{b13}. For each pixel in the image grid, all corresponding transmit-receive paths are evaluated using geometric delay calculations from the \texttt{delay\_laws3Dint} function. The respective time-domain signals are compensated for by delay and summed coherently to synthesize a focused response at each point. Interpolation is applied to align non-integer delays.

\subsection{Envelope Detection and Normalization}
After reconstruction, the A-scan signal envelope is extracted using the analytic signal through the Hilbert transform. Each envelope is normalized relative to the global image maximum to facilitate consistent FWHM measurements. Beam profiles are extracted along the central axis or focal plane depending on the analysis.

\subsection{Evaluation Procedure}
The envelope data are used to compute the FWHM as described in Section IV. Multiple beam positions and parameter configurations (focal depth, angle, frequency) are tested to quantify system resolution. The simulation results are compared with the theoretical expectations derived from equation~\eqref{eq:fwhm_theory}, and the discrepancies are analyzed in light of interface distortions and delay law interpolation artifacts.

This methodology ensures that the digital twin framework is not only structurally faithful but also diagnostically relevant, enabling quantitative benchmarking against analytical standards and recent advances in phased array modeling.

\section{Results and Discussion}

The proposed digital twin framework was evaluated through a series of synthetic experiments, each replicating realistic conditions for phased-array ultrasonic inspections across fluid–solid interfaces. This section presents the core results and critical analysis of focus performance, delay law precision, and FWHM estimation across multiple test configurations.

\subsection{Test Configuration and Parameters}

All simulations used an 1D linear array immersed in water, targeting a steel half-space through a planar interface. Each array configuration consisted of 64 elements with an element width of 0.45 mm, kerf (gap) of 0.05 mm, and an elevation aperture of 10 mm. The excitation frequency was set to 5 MHz and the sampling rate was set to 50 MHz. The water and steel properties were fixed throughout all experiments, with sound speeds of 1480 m/s (water), 5900 m/s (steel longitudinal) and 3200 m/s (steel shear).

Table~\ref{tab:sim_config} summarizes key simulation parameters for each test case, including window type, refracted angle, focal design (F-number) and scanning grid.

\begin{table}[htbp]
\caption{Simulation Parameters per Test Case}
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
\textbf{Test} & \textbf{Apodization} & \textbf{DF} & \textbf{Dt0} & \textbf{Grid (X,Z)} & \textbf{Angle} \\
\hline
0001 & Rectangular & 25.0 & 15.0 & 450×900 & 0° \\
0002 & Hamming     & 25.0 & 15.0 & 21×81   & 0° \\
0003 & Rectangular & 25.0 & 15.0 & 81×201  & 0° \\
0004 & Hamming     & 25.0 & 15.0 & 81×201  & 0° \\
0005 & Rectangular & 25.0 & 15.0 & 81×201  & 0° \\
0006 & Hamming     & 25.0 & 15.0 & 81×201  & 0° \\
0007 & Rectangular & 15.0 & 15.0 & 51×50   & 0° \\
\hline
\end{tabular}
\label{tab:sim_config}
\end{center}
\end{table}

The interface depth was fixed at 15mm across all tests, and the focal depth varied through the F-number and scanning grid definitions. Each simulation calculated the appropriate delay laws through Snell-based tracing and followed a full FMC transmission strategy, storing raw A-scans for all transmit–receive element pairs. Apodization windows were varied to assess their effect on beam focusing and sidelobe suppression.

\subsection{Delay Law Resolution and Sampling Accuracy}

In all tests (0001-0007), the delay values computed in the elements of the transducer array ranged approximately from 0.6875 to 0.9893 samples. These values were obtained by calculating the geometric time-of-flight between each array element and the focal point, and then converting these delay times from microseconds to discrete samples using the system sampling frequency of 50 MHz. Given a sampling period of \( T_s = 1 / f_s = 20\ \text{ns} = 0.02\ \mu\text{s} \), a delay of 0.6875 samples corresponds to \( 0.6875 \times 0.02 = 13.75\ \text{ns} \), while 0.9893 samples correspond to \( 19.79\ \text{ns} \).

In digital beamforming systems, it is widely accepted that delay quantization errors should remain below 0.25 samples (ie, \(0.25 \times 0.02 = 5\ \text{ns}\)) to avoid significant degradation of focal quality. This design threshold ensures that time delays can be closely approximated, minimizing interpolation artifacts, and preserving the integrity of the synthesized beam pattern. Previous studies have shown that coarse quantization exceeding this threshold adversely affects the fidelity of the main lobe, raises sidelobe levels, and introduces artifacts from the grating lobe~\cite{b13,b14}. However, in all simulated test cases, this delay resolution tolerance was violated. The \textit{Sampling Check} analysis revealed pronounced misalignments between the continuous-time delay requirements and the discrete-time implementation grid, resulting in quantization-induced distortions. These effects are illustrated in Fig.~\ref{fig:delay_heatmap}, which presents a delay law heatmap, and Fig.~\ref{fig:delay_stem}, which highlights undersampling and coarse discretization in the delay profile for Test 0007.

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0007_delay_laws_heatmap.png}}
\caption{Delay law heatmap showing severe quantization misalignment (Test 0007).}
\label{fig:delay_heatmap}
\end{figure}

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0007_delay_laws_stem.png}}
\caption{Delay profile stem plot showing coarse steps and undersampling effects (Test 0007).}
\label{fig:delay_stem}
\end{figure}

\subsection{TFM Envelope and Focusing Quality}

The reconstruction of the TFM envelope, Fig.~\ref{fig:tfm_envelope} shows the spatial concentration of acoustic energy near the focal point. Among all simulations, only test 0002 demonstrated accurate focusing, with an error of FWHM below 8\%, confirming good agreement between synthetic focusing and theoretical expectations. In contrast, tests 0001, 0003, 0005 and 0007 exhibited significant beam spreading and degradation, with FWHM errors ranging from approximately 59\% to more than 140\%, indicating reduced focus quality due to delay misalignment or envelope resolution limitations, Fig.~\ref{fig:tfm_envelope_poor}.

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0002_tfm_envelope.png}}
\caption{TFM envelope showing accurate focusing with low FWHM error (Test 0002).}
\label{fig:tfm_envelope}
\end{figure}

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0007_tfm_envelope.png}}
\caption{TFM envelope showing degraded beam focus with high FWHM error (Test 0007).}
\label{fig:tfm_envelope_poor}
\end{figure}

\subsection{FWHM Evaluation across Methods}

Table~\ref{tab:fwhm_summary} summarizes the FWHM results of the definition-based method (F1) and alternative estimators F2–F7. Methods F4 and F5 consistently yielded values close to theoretical expectations, while F6 and F7 failed in most tests due to numerical instability or poor model fit. The definition-based approach (F1) overestimated FWHM in nearly all cases due to coarse envelope resolution and delay misalignment.

\begin{table}[htbp]
\caption{Summary of FWHM Estimations (Tests 0001–0007)}
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Test} & \textbf{FWHM (F1)} & \textbf{Error (\%)} & \textbf{Best Estimator} \\
\hline
0001 & 48.81 mm & 65.5\% & F3–F5 (∼17\% error) \\
0002 & 31.70 mm & 7.4\% & F4–F5 \\
0003 & 53.85 mm & 82.5\% & F2–F4 \\
0004 & 53.85 mm & 82.5\% & F4–F5 \\
0005 & 46.88 mm & 58.9\% & F4 \\
0006 & 46.88 mm & 58.9\% & F4 \\
0007 & 43.04 mm & 143.2\% & F2–F3 \\
\hline
\end{tabular}
\label{tab:fwhm_summary}
\end{center}
\end{table}

To highlight estimation consistency, Fig.~\ref{fig:fwhm_methods_test02} shows the seven FWHM estimation outputs for the well-focused case of test 0002.

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0002_Comparison of FWHM Estimation methods (F1-F7).png}}
\caption{FWHM estimation comparison (F1–F7) for a well-focused beam (Test 0002).}
\label{fig:fwhm_methods_test02}
\end{figure}

\subsection{Scientific Implications}

The discrepancy between analytical and simulated FWHM highlights practical challenges in phased array implementation, especially in the presence of refraction and delay quantization. Our results quantify resolution degradation and emphasize the importance of subsample delay interpolation and signal conditioning.

Moreover, by benchmarking seven FWHM methods under controlled simulation conditions, we contribute a reproducible framework for evaluating focusing performance, which could inform delay law design, hardware constraints, and system calibration.

Finally, Fig.~\ref{fig:digital_twin_field} provides a view of the simulated acoustic pressure field generated by the digital twin for the off-axis focal configuration in the test 0001.

\begin{figure}[htbp]
\centerline{\includegraphics[width=\linewidth]{test0001_digital_twin_field.png}}
\caption{Simulated acoustic field showing off-axis beam pattern and interface effects (Test 0001).}
\label{fig:digital_twin_field}
\end{figure}

\section{Conclusion}

This work presented a digital twin simulation framework for modeling and analyzing ultrasonic phased array imaging through fluid–solid interfaces. By combining canonical beam models, Snell-based delay law computation, and a synthetic FMC-TFM pipeline, the proposed system enables reproducible and physically grounded simulation of focusing performance and field propagation.

Quantitative evaluation based on FWHM analysis in seven methods revealed a significant variation in beam resolution depending on delay quantization and apodization settings of the delay. The framework successfully replicated key characteristics of ultrasonic focus and the results confirmed that model-based estimators (F4, F5) offer better alignment with theoretical predictions, especially when definition-based methods (F1) fail due to envelope coarseness or distortion.

These findings demonstrate the potential of the framework as a reliable testbed for phased array inspection development, parameter sensitivity studies, and signal processing benchmarking. Future work will focus on experimental validation, extension to anisotropic and multilayered media, and AI-assisted optimization of inspection configurations, all grounded in the digital twin framework. "Ultrasonic imaging" can be reintroduced in future papers where B-scan or TFM image reconstructions are explicitly demonstrated.

\section*{Acknowledgment}

This work was supported by the "Laboratório de Ultrassom" (LUS). The authors thank the University of São Paulo for infrastructure support.

\begin{thebibliography}{00}
\bibitem{b3}Anand, C., Groves, R. \& Benedictus, R. Modeling and Imaging of Ultrasonic Array Inspection of Side Drilled Holes in Layered Anisotropic Media. {\em Sensors}. \textbf{21} (2021), https://www.mdpi.com/1424-8220/21/14/4640
\bibitem{b6}Holmes, C., Drinkwater, B. \& Wilcox, P. Post-processing of the full matrix of ultrasonic transmit–receive array data for non-destructive evaluation. {\em NDT & E International}. \textbf{38}, 701-711 (2005), https://www.sciencedirect.com/science/article/pii/S0963869505000721
\bibitem{b2}Lai, X., Yang, L., Xiwang, H., Pang, Y., Song 宋学官, X. \& Sun, W. Digital twin-based structural health monitoring by combining measurement and computational data: An aircraft wing example. {\em Journal Of Manufacturing Systems}. \textbf{69} pp. 76-90 (2023,6)
\bibitem{b5}Lai, X., Yang, L., Xiwang, H., Pang, Y., Song 宋学官, X. \& Sun, W. Digital twin-based structural health monitoring by combining measurement and computational data: An aircraft wing example. {\em Journal Of Manufacturing Systems}. \textbf{69} pp. 76-90 (2023,6)
\bibitem{b1}Jr., L. W. Schmerr. Fundamentals of Ultrasonic Phased Arrays. (Springer Cham, 2014,8)
\bibitem{b15}Khorshidi, A. \& Ashoor, M. Quantitative assessment of full-width at half-maximum and detector energy threshold in X-ray imaging systems. {\em European Journal Of Radiology}. \textbf{176} pp. 111537 (2024), https://www.sciencedirect.com/science/article/pii/S0720048X24002535
\bibitem{b7}Rainio, O., Hällilä, J., Teuho, J. \& Klén, R. Methods for estimating full width at half maximum. {\em Signal, Image And Video Processing}. \textbf{19}, 289 (2025)
\bibitem{b12}Holmes, C., Drinkwater, B. \& Wilcox, P. Advanced post-processing for scanned ultrasonic arrays: Application to defect detection and classification in non-destructive evaluation. {\em Ultrasonics}. \textbf{48}, 636-642 (2008), https://www.sciencedirect.com/science/article/pii/S0041624X08001455, Selected Papers from ICU 2007
\bibitem{b13}Clark, C., Drinkwater, B. \& Wilcox, P. The post-processing of ultrasonic array data using the total focusing method. {\em Insight - Non-Destructive Testing And Condition Monitoring}. \textbf{46} pp. 677-680 (2004,11)
\bibitem{b8} Mansur Rodrigues Filho, J. \& Bélanger, P. Global total focusing method through digital twin and robotic automation for ultrasonic phased array inspection of complex components. {\em NDT & E International}. \textbf{137} pp. 102833 (2023), https://www.sciencedirect.com/science/article/pii/S0963869523000488
\bibitem{b9}Yang, Y., Zhang, P., Hao, M. \& Wang, S. Development and Testing of a Digital Twin Platform for Robotic Ultrasound. {\em 2024 IEEE 4th International Conference On Digital Twins And Parallel Intelligence (DTPI)}. pp. 500-504 (2024)
\bibitem{b10}Ohara, Y., Remillieux, M., Ulrich, T., Ozawa, S., Tsunoda, K., Tsuji, T. \& Mihara, T. Exploring 3D elastic-wave scattering at interfaces using high-resolution phased-array system. {\em Scientific Reports}. \textbf{12}, 8291 (2022)
\bibitem{b11}Kamarulzaman, M., Hamabe, R., Ohara, R., Sato, S., Izumi, S. \& Kawaguchi, H. Ultrasonic Raytracing Simulation Method for Data Augmentation to Surveil the Bathroom with Digital Twins. {\em 2024 IEEE UFFC Latin America Ultrasonics Symposium (LAUS)}. pp. 1-4 (2024)
\bibitem{b13}Bae, S., Song, H. \& Song, T. Analysis of the Time and Phase Delay Resolutions in Ultrasound Baseband I/Q Beamformers. {\em IEEE Transactions On Biomedical Engineering}. \textbf{68}, 1690-1701 (2021)
\bibitem{b14}Salim, T., Devlin, J. \& Whittington, J. Quantization Analysis for Reconfigurable Phased Array Beamforming.  (2006), https://api.semanticscholar.org/CorpusID:14443679
\end{thebibliography}
\end{document}
